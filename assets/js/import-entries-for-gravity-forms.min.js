var A=a=>typeof a=='function',b=a=>typeof a=='string';(function(){var _=function(C,_b){b(_b)&&A(C[_b])?C[_b]():C.dispatchEvent(b(_b)?new Event(_b, {bubbles:!0}):_b)},B=function(_a){const D=document.querySelectorAll(_a);if(D.length>1)return D;return D[0]},c=function(_A,_B,_c,_d=!1){document.addEventListener(_A,function(E){E.target.closest(_B)&&(_c.bind(E),_c.call(E,E.target.closest(_B)),_d&&E.preventDefault())})},d=function(aA,aB){aA.insertAdjacentHTML('beforeend',aB)},e=(aC=1)=>B('#progress_container').style.width=`${aC}%`,f=async (aD,aE=0)=>{if(aD.rows.length>0){aD.offset=aE;const aF=new FormData();aF.append('data',JSON.stringify(aD));aF.append('import_entries_gf_table_data_wpnonce',B('[name="import_entries_gf_table_data_wpnonce"]').value);B('#submit_button_import').style.display='none';e(1);const aG=await fetch(ajaxurl+'?action='+B('[name="action_import"]').value,{method:'POST',body:aF});const _C=await aG.json();_C.message&&(B('#submit_button_import').style.display='',alert(_C.message));_C.in_progress&&f(aD,_C.offset);if(_C.total_rows_found){let aH=~~_C.offset*100/_C.total_rows_found;aH<1&&(aH=1);e(aH)}_C.is_done&&(B('#please_wait_container').style.display='none',B('#import_is_done').style.display='',B('#submit_button_import').style.display='none',alert(_C.is_done))}};let g=null;c('click','[href="#select-csv"]',function(){if(g!==null){g.open();return}g=wp.media({title:'Select or Upload CSV file for import entries',button:{text:'Use this CSV file'},multiple:!1});g.on('select',function(){var aI=g.state().get('selection').first().toJSON();let aJ=B('#csv_file');aJ.value=aI.id;_(aJ,'change')});g.open()},!0);c('click','#submit_button_import',async function(){B('#import_submit_container').style.display='';let aK=B('[name="import_data"]');let aL=JSON.parse(aK.value);let aM=B('#import_form_list_row');aL['fields']={};for(const aN of aM.querySelectorAll('input, select, textarea'))aL['fields'][aN.value]=aN.name;await f(aL,1)});c('change','#csv_file',async function(){let aO=B('#submit_button');let aP=B('#csv_file');!aP.value.length?aO.style.display='none':aO.style.display='block'});c('click','#submit_button',async function(){let aQ=B('#csv_file');if(!aQ.value.length)return;let aR=B('#import_csv');let aS=new FormData(aR);var _D=await fetch(ajaxurl+'?action='+aS.get('action'),{method:'POST',body:aS});var _e=await _D.json();_e.message&&alert(_e.message);if(_e.rows){var F=_e.rows[0],G=_e.fields;let aT=B('#import_form_list_row');let aU=B('#import_form_list');let aV=B('#import_form_list_item');let aW='';for(let i=0;i<F.length;i++)aW+='<option value="'+i+'" data-if-selected="'+i+'">'+F[i]+'</option>';for(let i=0;i<G.length;i++){let aX=aV.innerHTML;aX=aX.replaceAll('{{fieldId}}',G[i][0]).replaceAll('{{options}}',aW).replace(new RegExp(`data-if-selected="${i}"`, 'g'),'selected').replaceAll('{{rowName}}',G[i][1]);d(aU,aX)}aT.style.display='';B('[name="import_data"]').value=JSON.stringify(_e);B('#start_import_field_container').style.display='';B('#import_field_container').style.display='none'}});c('change','#import_field_container_list',async function(){let aY=B('#import_field_container');let aZ=this.target.value;aZ!==''?aY.style.display='':aY.style.display='none'})})();
